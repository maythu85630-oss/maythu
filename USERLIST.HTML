<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ADMIN PANEL</title>
<link rel="icon" href="https://i.postimg.cc/fLx8vKb4/5c934dcd65d48-Dollar-Sign-Cartoon-Vector-Character.png" type="image/png">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<style>
/* ---------------- STYLES ---------------- */
body {font-family: Arial, sans-serif; background:#f8faff; padding:20px;}
.page-btn {white-space: nowrap;}
.delete-btn {background:red;color:white; margin-left:30px;}
.disable-btn, .turnon-btn {background:orange;color:white;}
#shutdownToggle {padding: 6px 40px; font-size:16px; border-radius:6px; background:#007bff; color:white; cursor:pointer; line-height:20px; white-space: nowrap;}
#userPage button[onclick="searchTable()"], #exportBtn {padding:8px 20px; font-size:14px; border-radius:6px; cursor:pointer; line-height:18px; white-space: nowrap;}
.tooltip-box {display:none; position:absolute; top:45px; left:45%; transform:translateX(-50%); background:#fff; border:1px solid #e0e0e0; padding:6px 4px; border-radius:10px; box-shadow:0 3px 8px rgba(0,0,0,0.12); z-index:100;}
.tooltip-box button {font-size:10px; padding:3px 3px; margin:2px; border:none; border-radius:6px; cursor:pointer; transition:all 0.2s ease; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.btn-change {background: linear-gradient(135deg, #43e97b, #38f9d7); color:white;}
.btn-change:hover {background: linear-gradient(135deg,#3bd06e,#2fdac3); transform: scale(1.05);}
#logoutImg {margin-left:-60px;}
button {border:none; padding:5px 12px; border-radius:5px; cursor:pointer; background:#007bff; color:white; transition: transform 0.15s ease;}
button:hover {opacity:0.85;}
.delete-btn, .disable-btn, .edit-btn, .turnon-btn {padding:4px 8px; font-size:12px; min-width:60px; height:28px; border-radius:4px;}
table {border-collapse:collapse; width:100%; margin-bottom:20px; background:#e6f0ff;}
th, td {border:1px solid #99c2ff; padding:8px; text-align:left;}
th {background: linear-gradient(100deg,#bae1ff 0%,#d6e9ff 100%);}
input[type="text"], input[type="file"], input[type="email"], input[type="password"], select {width:90%; padding:5px; box-sizing:border-box;}
img.preview {width:50px; height:auto; cursor:pointer;}
#imgModal {display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center;}
#imgModal img {max-width:90%; max-height:90%; border:3px solid #fff; cursor:pointer;}
.toast{position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:white; padding:25px; border-radius:12px; text-align:center; box-shadow:0 4px 15px rgba(0,0,0,0.2); display:none; z-index:3000;}
.toast .checkmark{width:60px; height:60px; border-radius:50%; border:3px solid #4caf50; display:flex; justify-content:center; align-items:center; margin:0 auto 10px;}
.toast .checkmark::after{content:"âœ”"; color:#4caf50; font-size:30px;}
.toast p{margin:0;font-size:16px; color:#333;}
.search-input {width:250px; padding:5px 10px; font-size:16px; border:3px solid #99c2ff; border-radius:6px; margin-right:10px;}
.swal2-popup {background-color:white !important; width:350px !important; font-size:14px !important; padding:20px !important; min-width:60px !important;}
.swal2-confirm {background-color:#007bff !important; color:white !important; font-size:14px !important; padding:6px 14px !important; min-width:70px !important; min-height:30px !important; border-radius:4px !important;}
.swal2-deny, .swal2-cancel {background-color:#dc3545 !important; color:white !important; font-size:14px !important; padding:6px 14px !important; min-width:70px !important; min-height:30px !important; border-radius:4px !important;}
.swal-confirm-red {background-color:#e74c3c !important; color:white !important;}
.swal-cancel-blue {background-color:#3498db !important; color:white !important;}
</style>
</head>
<body>

<div style="position:absolute; top:20px; right:20px; text-align:center;">
  <input type="file" id="logoutFile" accept="image/*" style="display:none">
  <img src="https://maythu85630-oss.github.io/maythu/static/image3/photo.png" alt="photo" style="width:40px; height:40px; cursor:pointer; border-radius:50%;">
</div>

<!-- Image Modal -->
<div id="imgModal" onclick="toggleModal()">
  <img id="modalImg" src="" alt="Preview Image">
</div>

<!-- Toast -->
<div class="toast" id="toast">
  <div class="checkmark"></div>
  <p>Phone number copied!</p>
</div>

<!-- Page Toggle -->
<div style="display:flex; gap:15px; margin-bottom:15px;">
  <button class="page-btn" onclick="showPage('accountPage')">ðŸ‘¥ ACCOUNT USER</button>
  <button class="page-btn" onclick="showPage('userPage')">ðŸ‘¤ USER LIST</button>
</div>

<!-- ACCOUNT USER PAGE -->
<div id="accountPage" style="display:none; text-align: center;">
  <h2 style="margin: 20px 0;">WELCOME</h2>
  <img src="https://maythu85630-oss.github.io/maythu/static/image1/photo.png" alt="photo" style="width:80px;height:auto;">
  <p style="font-size: 16px; color: #333;">á€•á€¼á€„á€ºá€†á€„á€ºá€žá€Šá€º</p>
</div>

<!-- USER LIST PAGE -->
<div id="userPage">
  <table>
    <thead>
      <tr>
        <th>No.</th><th>Name</th><th>Phone Number</th><th>Date</th><th>Photo</th><th>Platfrom</th><th>Status</th><th>Reason</th><th>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>-</td>
        <td><input type="text" id="name" placeholder="Full Name"></td>
        <td><input type="text" id="phone" placeholder="Phone Number"></td>
        <td><input type="text" id="birthday" placeholder="DD-MM-YY"></td>
        <td><input type="file" id="nrc" accept="image/*"></td>
        <td><input type="text" id="gn" placeholder="Platfrom"></td>
        <td><input type="text" id="reason" placeholder="Status"></td>
        <td><input type="text" id="status" placeholder="Reason"></td>
        <td><button onclick="addRow()">âœ” ADD</button></td>
      </tr>
    </tbody>
  </table>

<div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
  <button id="shutdownToggle" onclick="toggleShutdown()">Shut down List</button>
  <input type="text" id="searchInput" class="search-input" placeholder="Search Name/Phone">
  <button onclick="searchTable()">Search</button>
  <button id="exportBtn" onclick="exportData()">Export</button>
</div>

<!-- Main Data Table -->
<table id="dataTable">
  <thead>
    <tr>
      <th>No.</th><th>Name</th><th>Phone Number</th><th>Date</th><th>Photo</th><th>Platfrom</th><th>Status</th><th>Reason</th><th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- Shutdown Table -->
<table id="shutdownTable" style="display:none;">
  <thead>
    <tr>
      <th>No.</th><th>Name</th><th>Phone Number</th><th>Date</th><th>Photo</th><th>Platfrom</th><th>Status</th><th>Reason</th><th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

// âœ… á€•á€¼á€„á€ºá€œá€­á€¯á€€á€ºá€•á€«: Firebase á€€á€­á€¯ á€¡á€™á€¾á€”á€º URL á€–á€¼á€„á€·á€ºá€‘á€Šá€·á€ºá€•á€«
const firebaseConfig = {
  apiKey: "...",
  authDomain: "...",
  databaseURL: "https://<your-project-id>.firebaseio.com",
  projectId: "...",
  storageBucket: "...",
  messagingSenderId: "...",
  appId: "..."
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Save data to Firebase
function saveDataToFirebase() {
  const main = getTableData("dataTable");
  const shutdown = getTableData("shutdownTable");
  set(ref(db, 'users'), { main, shutdown });
}

// Listen for Firebase changes
onValue(ref(db, 'users/'), (snapshot) => {
  const data = snapshot.val();
  if (!data) return;
  document.querySelector("#dataTable tbody").innerHTML = "";
  document.querySelector("#shutdownTable tbody").innerHTML = "";
  (data.main || []).forEach(d => insertRow(d, "dataTable"));
  (data.shutdown || []).forEach(d => insertRow(d, "shutdownTable", true));
  renumber();
});

window.saveDataToFirebase = saveDataToFirebase;
</script>

<script>
// -------------- MAIN JS --------------
const STORAGE_KEY="enterpriseFormSystem_v11";
const PAGE_KEY="currentPage_v2";

function showPage(page){
  localStorage.setItem(PAGE_KEY,page);
  document.getElementById('userPage').style.display = (page==='userPage') ? 'block' : 'none';
  document.getElementById('accountPage').style.display = (page==='accountPage') ? 'block' : 'none';
}

function toggleModal(){ 
  document.getElementById("imgModal").style.display=(document.getElementById("imgModal").style.display==="flex")?"none":"flex"; 
}
function previewImage(src){ 
  document.getElementById("modalImg").src=src; 
  document.getElementById("imgModal").style.display="flex"; 
}

function getTableData(id){ 
  return Array.from(document.getElementById(id).querySelector("tbody").rows).map(r=>({
    name:r.cells[1].querySelector('input')?.value||"",
    phone:r.cells[2].querySelector('input')?.value||"",
    birthday:r.cells[3].querySelector('input')?.value||"",
    nrc:r.cells[4].querySelector("img")?.src||"",
    gn:r.cells[5].querySelector('input')?.value||"",
    reason:r.cells[6].querySelector('input')?.value||"",
    status:r.cells[7].querySelector('input')?.value||""
  }));
}

// (JS functions: addRow, insertFormRow, clearForm, insertRow, copyPhone, fallbackCopy, editUserRow, saveUserEdit, updateNRC, disableRow, turnOnRow, getRowData, deleteRow, renumber, toggleShutdown, searchTable, compressImage)
//  ... á€¤á€”á€±á€›á€¬á€™á€¾á€¬ á€¡á€Ÿá€±á€¬á€„á€ºá€¸ JS á€€á€­á€¯ ê·¸ëŒ€ë¡œ á€‘á€Šá€·á€ºá€”á€­á€¯á€„á€ºá€•á€«á€á€šá€º

window.onload = () => {
  loadData();
  showPage(localStorage.getItem(PAGE_KEY) || "accountPage");
};
</script>

</body>
</html>
